<!DOCTYPE html>
<html layout:decorator="layout">
  <head>
    <title>Car Data</title>
    <script th:inline="javascript" type="text/javascript">
        /*<![CDATA[*/
            $(document).ready(function() {
                var request = $.ajax({
                    url: "/resources/cars", 
                    method: "GET",
    	        });

                request.done(function(data) {
            	    $.each(data, function(i, item) {
                        var year = item.year ? item.year.toString() : "";
                        var make = item.make ? item.make : "";
                        var model = item.model ? item.model : "";
                        var trimLevelsArray = [];
                        var trimLevelsString = "";

                        for (var i=0; i<item.trimLevels.length; i++) {
                            trimLevelsArray.push(item.trimLevels[i].name);
                        }

                        // Sort trim levels
                        if (trimLevelsArray.length > 0) {
                            trimLevelsArray.sort(function (a,b) {
                            	var nameA = a.toLowerCase();
                            	var nameB = b.toLowerCase();

                            	if (nameA < nameB) return -1;
                                if (nameA > nameB) return 1;

                                return 0;
                            });
                            trimLevelsString = trimLevelsArray.join(", ");
                        }

                        $("#tablebody").append("<tr>" +
                                               "<td>" + escapeHtml(year) + "</td>" +
                                               "<td>" + escapeHtml(make) + "</td>" +
                                               "<td>" + escapeHtml(model) + "</td>" +
                                               "<td>" + escapeHtml(trimLevelsString) + "</td>" +
                                               "</tr>");
            	    });
                });
            });
        /*]]>*/
    </script>
  </head>
  <body>
    <div class="container" layout:fragment="content">
      <table class="table">
        <thead>
          <tr>
            <th>Year</th>
            <th>Make</th>
            <th>Model</th>
            <th>Trim Levels</th>
          </tr>
        </thead>
        <tbody id="tablebody">
        </tbody>
      </table>
    </div>
  </body>
</html>